<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    {% load static %}
    <title>Главная страница</title>
    <link rel="stylesheet"  href="{% static 'css/style.css' %}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
   <nav class="navbar">
    <div class="navbar-left">
        {% load static %}
        <a href="/home" class="logo"><img src="{% static 'img/start.png' %}"></a>
        <form action="{% url 'search_by_hashtag' %}" method="get">
        <div class="searchbox">
<!--            <img src="{% static 'img/search.png' %}">-->
            <input type="text" name="tag" placeholder="Поиск по тегам">
            <button type="submit" class="search-button"><i class="fas fa-search"></i></button>
        </div>
        </form>
    </div>
    <div class="navbar-center">
    </div>
    <div class="navbar-right">
        <img src="{{user.profile.image.url}}" class="nav-profile-img" onclick="toggleMenu()">
    </div>
    <div class="profile-menu-wrap" id="profileMenu">
        <div class="profile-menu">
            <div class="user-info">
                <img src="{{user.profile.image.url}}" alt="">
                <div>
                    <h3><a href="/profile/{{user.username}}" class="profile-menu-links">{{user.username}}</a></h3>
                </div>
            </div>
            <a href="/settings" class="profile-menu-links">
                <img src="{% static 'img/settings.png' %}" alt="">
                <p>Настройки</p>
            </a>
            <a href="#" class="profile-menu-links">
                <img src="{% static 'img/logout.png' %}" alt="">
                <p>Выход</p>
            </a>
        </div>
    </div>
   </nav>
   <div class="container">
    <div class="main">
    <form class="create-post-form" id="post_form" action="/tweet/" method="POST">
            {% csrf_token %}
            <div class="create-post">
             <div class="form-container">
                <div class="textarea-container">
                    <div class="textarea-first">
                        <img src="{{user.profile.image.url}}">
                        {{ form.content }}
                    </div>
                </div>
                <div class="textarea-container textarea-second-line">
                    <div class="textarea-second" id="tag-area">{{ form.hashtags }}</div>
                    <button type="submit" class="submit-button">Поделиться</button>
                </div>
            </div>
        </div>
    </form>
        <a href ="/tweet" onclick="handleClick(event)"><div id="new_tweets"></div></a>
        {% if flag_posts %}
        {% for tweet in tweets %}
        <div class="post" data-post-id="{{ tweet.id }}" onclick="openModal({{ tweet.id }});">
            <div class="post-author">
                <a href="/profile/{{tweet.author.username}}" onclick="childClick(event);">
                    <img src=" {{ tweet.author.profile.image.url }}">
                </a>
                <div>
                    <a href="/profile/{{tweet.author.username}}" onclick="childClick(event);"><h1>{{tweet.author.username}}</h1></a>
                    <small>{{tweet.date_posted}}</small>
                </div>
                {% if tweet.author.username == user.username %}
                <button class="edit-delete-btn" id="edit-delete-btn-{{tweet.id}}" onclick="childClick(event);">
                    <i class="fas fa-ellipsis-v"></i> <!-- Иконка для кнопки -->
                </button>
                <!-- Всплывающее окно -->
                <div class="popup-menu" onclick="childClick(event);">
                    <button onclick="editPost({{tweet.id}});">Редактировать</button>
                    <button onclick="deletePost({{tweet.id}})">Удалить</button>
                </div>
                {% endif %}
            </div>
            <div class="post-content" id="content-{{tweet.id}}">
               {{tweet.content}}
               <div id="button-container"></div>
                 <!--<textarea rows=2 class="edit-area" id="edit-{{tweet.id}}" oninput="autoResize(this)" required></textarea>-->
            </div>
            <div class="post-activity">
                <div class="post-activity-link">
                    <button id="likeBtn-{{tweet.id}}" class="like-btn" data-liked="{% if tweet.id in liked_tweet_ids %}true{% else %}false{% endif %}" onclick=" likeClick(event, {{tweet.id}})">
                        {% if tweet.id in liked_tweet_ids %}
                            <i class="fas fa-heart" style="color: #704c9e;"></i> <!-- Закрашенное сердце -->
                        {% else %}
                            <i class="far fa-heart"></i> <!-- Обведённое сердце -->
                        {% endif %}
                    </button>
                    <span id="likeCount-{{ tweet.id }}">{{ tweet.likes }}</span>
                </div>
            </div>
            <ul class="tag-container" onclick="childClick(event);">
                    {% for tag in tweet.hashtags.all %}
                    <li>
                    <a href="/search/?tag={{tag.text}}" style="color: white; text-decoration: none;">
                        <span class="tag-label"><i class="fas fa-circle" style="margin-left: -5px;"></i>{{tag.text}}</span>
                    </a>
                    </li>
                    {% endfor %}
            </ul>
            <div class="comment-section" onclick="childClick(event)">
                 <!-- Список комментариев -->
<!--                <div id="comment-list-{{tweet.id}}">-->
<!--                    <hr class="comment-line">-->
<!--                    <div class="comment-item">-->
<!--                        <img src="{% static 'img/start.jpg' %}">-->
<!--                        <div class="comment-content">-->
<!--                            <strong>user</strong>-->
<!--                            <p>comment</p>-->
<!--                            <span class="comment-date">09 октября 2024</span>-->
<!--                        </div>-->
<!--                    </div>-->
<!--                </div>-->
              <!-- Секция для добавления нового комментария -->
                <div class="comment-item" onclick="childClick(event)">
                    <img src="{{user.profile.image.url}}">
                    <textarea rows=1 class="comment-input" id="comment-{{tweet.id}}" placeholder="Напишите ваш комментарий..." oninput="autoResize(this)" required></textarea>
                    <button class="submit-comment" onclick="addComment({{tweet.id}})">Отправить</button>
                </div>
            </div>
        </div>
         {% endfor %}
         {% endif %}
        <div class="right-sidebar">
            <div class="subscriptions-panel">
                <h3>Ваши подписки</h3>
                <ul class="subscriptions-list">
                    {% for user in object_list %}
                    {% if forloop.counter <= 5 %}
                    <li class="subscription-item">
                       <button onclick="location.href='/profile/{{user.follow_user.username}}'" style="display: flex; align-items: center; border: none; background: none; cursor: pointer;">
                        <img src="{{ user.follow_user.profile.image.url }}">
                        <span>{{ user.follow_user.username }}</span>
                        </button>
                    </li>
                    {% endif %}
                    {% endfor %}
                    <li class="subscription-item">
                       <button onclick="openFollowingsModal();" style="display: flex; align-items: center; border: none; background: none; cursor: pointer;">
                        <span>Показать всех</span>
                        </button>
                    </li>
                </ul>
            </div>
        </div>
    </div>
    <!-- Модальное окно -->
    <div id="tweetModal" class="modal" style="display: none;">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <div class="modal-header">
                 <a id="author-link-img" href=""><img id="modal-img"></a>
                 <a id="author-link" href=""><h2 id="modal-author"></h2></a>
            </div>
            <p id="modal-content"></p>
            <small id="modal-date"></small>
            <div class="post-activity">
                <div class="post-activity-link">
                    <button id="modal-likeBtn" class="like-btn" data-liked="">
                    </button>
                    <span id="modal-likes-count"></span>
                </div>
            </div>
            <ul id="modal-tag-container" class="tag-container"></ul>
            <div id="modal-comments"></div>
        </div>
    </div>
    <!-- Модальное окно для подписок -->
    <div id="followingsModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeFollowingsModal()">&times;</span>
        <h2>Ваши подписки</h2>
        <ul class="subscriptions-list">
            {% for user in object_list %}
            <li class="subscription-item">
                <button onclick="location.href='/profile/{{user.follow_user.username}}'" style="display: flex; align-items: center; border: none; background: none; cursor: pointer;">
                <div class="user-avatar"><img src="{{ user.follow_user.profile.image.url }}"></div>
                <span>{{ user.follow_user.username }}</span>
                </button>
                </li>
            </li>
            {% endfor %}
        </ul>
    </div>
</div>
<script src="{% static 'js/script.js' %}"></script>
</body>

